<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurePager Pro | Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2a6c;
            --secondary: #b21f1f;
            --tertiary: #fdbb2d;
            --light: #f8f9fa;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--tertiary));
            min-height: 100vh;
            padding: 20px;
            color: var(--light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, var(--light), var(--tertiary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: var(--glass-bg);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .admin-badge {
            background: var(--tertiary);
            color: black;
            font-weight: bold;
        }

        .btn {
            padding: 8px 16px;
            background: var(--glass-bg);
            color: white;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
        }

        .btn-danger {
            background: #e52e71;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--glass-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--tertiary);
            margin-bottom: 5px;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-header h2 {
            color: var(--tertiary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(255, 255, 255, 0.1);
            color: var(--tertiary);
        }

        .badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .badge-success { background: #28a745; }
        .badge-warning { background: #ff8a00; }
        .badge-danger { background: #e52e71; }
        .badge-info { background: #1a2a6c; }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <h1><i class="fas fa-cogs"></i> Admin Panel</h1>
            </div>
            <div class="user-info">
                <div class="user-badge admin-badge">
                    <i class="fas fa-shield-alt"></i> ADMIN
                </div>
                <div class="user-badge">
                    <i class="fas fa-user"></i> <span id="username">User</span>
                </div>
                <a href="index.html" class="btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalMessages">0</div>
                <div>Total Messages</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div>Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="unreadMessages">0</div>
                <div>Unread Messages</div>
            </div>
        </div>

        <div class="glass-card">
            <div class="card-header">
                <h2><i class="fas fa-envelope"></i> All Messages</h2>
                <div>
                    <button class="btn btn-danger" id="clearMessages">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
            </div>
            
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Sender</th>
                            <th>Receiver</th>
                            <th>Priority</th>
                            <th>Message</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="messagesTable">
                        <!-- Messages will load here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="glass-card">
            <div class="card-header">
                <h2><i class="fas fa-users"></i> System Users</h2>
            </div>
            
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Role</th>
                            <th>ID</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <!-- Users will load here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        class AdminApp {
            constructor() {
                this.currentUser = null;
                this.init();
            }

            init() {
                this.checkAuth();
                this.setupEvents();
                this.loadData();
                this.startPolling();
            }

            checkAuth() {
                const userData = sessionStorage.getItem('currentUser');
                if (!userData) {
                    window.location.href = 'index.html';
                    return;
                }

                this.currentUser = JSON.parse(userData);
                if (this.currentUser.role !== 'admin') {
                    alert('Admin access only');
                    window.location.href = 'index.html';
                    return;
                }

                document.getElementById('username').textContent = this.currentUser.username;
            }

            setupEvents() {
                document.getElementById('clearMessages').addEventListener('click', () => {
                    if (confirm('Clear all messages? This cannot be undone.')) {
                        localStorage.setItem('pagerMessages', JSON.stringify([]));
                        this.loadData();
                        this.showNotification('All messages cleared');
                    }
                });
            }

            loadData() {
                const messages = JSON.parse(localStorage.getItem('pagerMessages') || '[]');
                const users = JSON.parse(localStorage.getItem('pagerUsers') || '[]');

                this.displayMessages(messages);
                this.displayUsers(users);
                this.updateStats(messages, users);
            }

            displayMessages(messages) {
                const tbody = document.getElementById('messagesTable');
                const sorted = messages.sort((a, b) => b.timestamp - a.timestamp);

                if (sorted.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">No messages found</td></tr>';
                    return;
                }

                tbody.innerHTML = sorted.map(msg => `
                    <tr>
                        <td>${new Date(msg.timestamp).toLocaleString()}</td>
                        <td>${msg.sender || 'Unknown'}</td>
                        <td>${msg.receiverId}</td>
                        <td>
                            <span class="badge badge-${this.getPriorityClass(msg.priority)}">
                                ${msg.priority.toUpperCase()}
                            </span>
                        </td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            ${msg.content}
                        </td>
                        <td>
                            <span class="badge ${msg.read ? 'badge-success' : 'badge-warning'}">
                                ${msg.read ? 'READ' : 'UNREAD'}
                            </span>
                        </td>
                    </tr>
                `).join('');
            }

            displayUsers(users) {
                const tbody = document.getElementById('usersTable');
                
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.username}</td>
                        <td>
                            <span class="badge badge-${this.getRoleClass(user.role)}">
                                ${user.role.toUpperCase()}
                            </span>
                        </td>
                        <td>${user.id}</td>
                        <td>
                            <span class="badge badge-success">
                                ACTIVE
                            </span>
                        </td>
                    </tr>
                `).join('');
            }

            updateStats(messages, users) {
                document.getElementById('totalMessages').textContent = messages.length;
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('unreadMessages').textContent = messages.filter(m => !m.read).length;
            }

            getPriorityClass(priority) {
                return {
                    high: 'danger',
                    medium: 'warning',
                    low: 'info'
                }[priority] || 'info';
            }

            getRoleClass(role) {
                return {
                    admin: 'danger',
                    sender: 'info',
                    receiver: 'success'
                }[role] || 'info';
            }

            startPolling() {
                setInterval(() => {
                    this.loadData();
                }, 5000);
            }

            showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = 'notification show';
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        new AdminApp();
    </script>
</body>
</html>
